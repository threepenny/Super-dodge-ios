<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SUPER DODGE PRO</title>
    <style>
        body { margin: 0; background: #121212; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; touch-action: none; color: white; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; left: 20px; pointer-events: none; }
        .stat { font-size: 20px; font-weight: bold; margin-bottom: 5px; }
        #menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 100%; }
        h1 { font-size: 48px; color: #1e90ff; margin-bottom: 10px; text-shadow: 0 0 20px rgba(30,144,255,0.5); }
        p { font-size: 18px; opacity: 0.8; }
    </style>
</head>
<body>
    <div id="ui">
        <div id="scoreDisplay" class="stat">SCORE: 0</div>
        <div id="bestDisplay" class="stat" style="opacity: 0.5;">BEST: 0</div>
    </div>

    <div id="menu">
        <h1>SUPER DODGE</h1>
        <p>TAP TO START</p>
        <p style="font-size: 14px; margin-top: 20px;">Avoid Red • Collect Green • Blue is Shield</p>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const menu = document.getElementById('menu');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const bestDisplay = document.getElementById('bestDisplay');

        // Initial Setup
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Game Constants
        const SKINS = ["#1e90ff", "#ffa500", "#9b59b6", "#f1c40f", "#1abc9c"];
        
        // Game Variables
        let score = 0;
        let high_score = localStorage.getItem('high_score') || 0;
        let gameActive = false;
        let playerX = canvas.width / 2;
        let objects = [];
        let speed = 5;
        let hasShield = false;
        let shake = 0;

        bestDisplay.innerText = "BEST: " + high_score;

        // --- INPUT ---
        window.addEventListener('touchmove', (e) => {
            if(gameActive) playerX = e.touches[0].clientX;
        });
        
        window.addEventListener('touchstart', () => { 
            if(!gameActive) startGame(); 
        });

        // --- VIBRATION HELPERS ---
        function vibe(pattern) {
            if (navigator.vibrate) navigator.vibrate(pattern);
        }

        function startGame() {
            score = 0;
            speed = 5;
            objects = [];
            hasShield = false;
            gameActive = true;
            menu.style.display = 'none';
            vibe(50);
        }

        function gameOver() {
            gameActive = false;
            menu.style.display = 'block';
            vibe([100, 50, 100]); // Heavy vibration
            if(score > high_score) {
                high_score = score;
                localStorage.setItem('high_score', high_score);
                bestDisplay.innerText = "BEST: " + high_score;
            }
        }

        function spawn() {
            if(Math.random() < 0.05 + (score * 0.001)) {
                let type = 'good'; // Green
                let r = Math.random();
                if(r < 0.25) type = 'bad';   // Red
                if(r < 0.02) type = 'shield'; // Blue
                
                objects.push({
                    x: Math.random() * (canvas.width - 40) + 20,
                    y: -50,
                    type: type
                });
            }
        }

        function update() {
            if(!gameActive) {
                requestAnimationFrame(update);
                return;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Screen Shake
            let offsetX = 0;
            if(shake > 0) {
                offsetX = Math.random() * 10 - 5;
                shake--;
            }

            spawn();

            // Draw Player
            let skinColor = SKINS[Math.min(Math.floor(score/10), SKINS.length - 1)];
            ctx.fillStyle = skinColor;
            ctx.shadowBlur = hasShield ? 20 : 0;
            ctx.shadowColor = "#1e90ff";
            ctx.beginPath();
            ctx.roundRect(playerX - 30 + offsetX, canvas.height - 100, 60, 60, 10);
            ctx.fill();
            ctx.shadowBlur = 0; // Reset shadow

            // Update Objects
            objects.forEach((obj, i) => {
                obj.y += speed;

                if(obj.type === 'good') ctx.fillStyle = "#32ff7e";
                else if(obj.type === 'bad') ctx.fillStyle = "#ff4757";
                else ctx.fillStyle = "#1e90ff";

                ctx.beginPath();
                if(obj.type === 'shield') ctx.rect(obj.x - 15, obj.y - 15, 30, 30);
                else ctx.arc(obj.x + offsetX, obj.y, 18, 0, Math.PI * 2);
                ctx.fill();

                // Collision Detection
                let pRect = { x: playerX - 30, y: canvas.height - 100, w: 60, h: 60 };
                if(obj.y > pRect.y && obj.y < pRect.y + pRect.h && Math.abs(obj.x - playerX) < 45) {
                    if(obj.type === 'good') {
                        score++;
                        speed += 0.05;
                        vibe(20);
                        if(score % 10 === 0) vibe([30, 50, 30]); // Level up pulse
                        scoreDisplay.innerText = "SCORE: " + score;
                        objects.splice(i, 1);
                    } else if(obj.type === 'shield') {
                        hasShield = true;
                        vibe(40);
                        objects.splice(i, 1);
                    } else {
                        if(hasShield) {
                            hasShield = false;
                            shake = 10;
                            vibe(60);
                            objects.splice(i, 1);
                        } else {
                            gameOver();
                        }
                    }
                }

                if(obj.y > canvas.height) objects.splice(i, 1);
            });

            requestAnimationFrame(update);
        }

        update();
    </script>
</body>
</html>
